<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-LibraryAI - Home</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="theme.css">
    <script src="side-bar.js" defer></script>
    <script src="common.js" defer></script>
    <script src="chat.js" defer></script>
    <script src="settings.js" defer></script>
    
    <style>
        /* Welcome Section */
        .welcome-section h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .welcome-section p {
            font-size: 1.2em;
            color: #ccc;
        }

        /* Genre Cards */
        .genre-cards {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            overflow-x: auto;
            padding-bottom: 15px;
        }

        .genre-card {
            width: 120px;
            height: 120px;
            border-radius: 15px;
            overflow: hidden;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .genre-card:hover {
            transform: scale(1.05);
        }

        .genre-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Personalized Section */
        .personalized-section {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 15px;
            margin: 30px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .personalized-section h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .personalized-section p {
            font-size: 1em;
            color: #ccc;
        }

        .personalized-section .button {
            background-color: #1a73e8;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .personalized-section .button:hover {
            background-color: #1557b0;
        }

        /* Goals Section */
        .goals-section {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .goal-item {
            width: 80px;
            height: 80px;
            background-color: #2a2a2a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        
        .goal-item:hover {
            transform: scale(1.1);
            background-color: #333;
        }


        /* Sub-heading */
        .sub-heading {
            color: #666;
            margin-top: 5px;
        }

        .personalized-section {
    background-color: var(--card-bg-color, #2a2a2a);
    border: 1px solid var(--border-color, #444);
}

.personalized-section h2 {
    color: var(--text-primary-color, #fff);
}

.personalized-section p {
    color: var(--text-secondary-color, #ccc);
}

/* Theme-specific adjustments */
body[data-theme="light"] .personalized-section {
    background-color: #f0f0f0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

body[data-theme="light"] .personalized-section h2 {
    color: #333;
}

body[data-theme="light"] .personalized-section p {
    color: #666;
}

body[data-theme="sepia"] .personalized-section {
    background-color: #f4ecd8;
}

body[data-theme="sepia"] .personalized-section h2 {
    color: #5b4636;
}

body[data-theme="sepia"] .personalized-section p {
    color: #7d6a5a;
}

/* Goal items theme adjustments */
.goal-item {
    background-color: var(--goal-item-bg-color, #2a2a2a);
    color: var(--text-primary-color, #fff);
}

body[data-theme="light"] .goal-item {
    background-color: #f0f0f0;
    color: #333;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

body[data-theme="sepia"] .goal-item {
    background-color: #f4ecd8;
    color: #5b4636;
}

body[data-theme="sepia"] .goal-item.active {
    background-color: var(--highlight-color, #a07e5f);
}
    
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <img src="https://www.gutenberg.org/pics/pg-logo-002.png" alt="Logo">
            <span class="nav-text">E-LibraryAI</span>
        </div>
        <a href="home.html" class="nav-item">üè† <span class="nav-text">Home</span></a>
        <a href="search.html" class="nav-item">üîç <span class="nav-text">Search</span></a>
        <a href="recommendations.html" class="nav-item">üìö <span class="nav-text">Collections</span></a>
        
        <div style="margin-top: auto;">
            <a href="index.html" class="nav-item">üë§ <span class="nav-text">Profile</span></a>
            <a href="settings.html" class="nav-item">‚öôÔ∏è <span class="nav-text">Settings</span></a>
            <a href="login.html" class="nav-item">‚Ü™Ô∏è <span class="nav-text">Log Out</span></a>
        </div>
        <button class="collapse-btn">‚óÄ</button>
    </div>
    <div class="main-content">
        
        <div class="welcome-section">
            <div class="header">
                <h1>Welcome to E-LibraryAI!</h1>
                
                <div class="header-icons">
                    <span>üîî</span>
                    <span>‚úâÔ∏è</span>
                    <span>üí¨</span>
                </div>
            </div>
            <p>Explore Project Gutenberg's Collection</p>
        </div>
        
        <h3 style="margin-top: 30px;">Popular Genres</h3>
        <div class="genre-cards" id="booksContainer">
            <!-- Books will be loaded here -->
            <div class="loading">Loading popular genres...</div>
        </div>

        <div class="personalized-section">
            <div>
                <h2>üìö Personalized</h2>
                <p>Find your next favorite book!</p>
            </div>
            <button class="button" onclick="fetchRecommendedBooks()">Get Suggestions</button>
        </div>

        <div class="personalized-section">
            <div>
                <h2>üó£Ô∏è Language Learning</h2>
                <p>Enhance your vocabulary</p>
            </div>
            <button class="button" onclick="fetchBooksByLanguage('en')">Start Learning</button>
        </div>

        <h3>Reading Goals</h3>
        <div class="goals-section">
            <div class="goal-item" onclick="alert('Daily reading goal: 30 minutes')">üìö</div>
            <div class="goal-item" onclick="alert('Audiobooks: Try listening to classics')">üéß</div>
            <div class="goal-item" onclick="alert('Vocabulary builder: Learn 5 new words daily')">üî§</div>
            <div class="goal-item" onclick="alert('Reading tracker: 3 books completed')">‚úì</div>
        </div>
    </div>

    <div class="chat-panel">
        <button class="collapse-btn">‚ñ∂</button>
        <div class="chat-content">
            <div class="chat-header">
                <h2>AI Book Assistant</h2>
                <span>‚ñº</span>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Top Readers</h3>
                <a href="#" style="color: #666; text-decoration: none;">See More</a>
            </div>
            <div id="topBooks">
                <!-- Top books will be loaded here -->
            </div>

            <div class="chat-messages">
                <!-- Chat messages will be loaded here -->
            </div>

            <div class="chat-input">
                <input type="text" placeholder="Ask about books...">
            </div>

            <div class="featured-books">
                <div onclick="fetchBooksByCategory('popular')">
                    <span>üìö Top Free eBooks</span>
                    <span>‚Üí</span>
                </div>
                <div onclick="fetchBooksByCategory('trending')">
                    <span>üåü Trending Now</span>
                    <span>‚Üí</span>
                </div>
                <div onclick="fetchBooksByCategory('classic')">
                    <span>üîñ Classic Literature</span>
                    <span>‚Üí</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GUTENDEX_API = '/api/';
        
        // Fetch books by category
        async function fetchBooksByCategory(category) {
            try {
                const chatMessages = document.querySelector('.chat-messages');
                addBotMessage(`Fetching ${category} books for you...`);
                
                const response = await fetch(`${GUTENDEX_API}recommendations?genre=${category}`);
                const data = await response.json();
                
                if (data.books && data.books.length > 0) {
                    addBotMessage(`Here are some ${category} books you might enjoy. Check them out!`);
                } else {
                    addBotMessage(`I couldn't find any ${category} books at the moment. Try again later.`);
                }
            } catch (error) {
                console.error('Error fetching books:', error);
                addBotMessage("Sorry, I had trouble fetching those books. Please try again later.");
            }
        }
        
        // Fetch books by language
        async function fetchBooksByLanguage(language) {
            try {
                const chatMessages = document.querySelector('.chat-messages');
                const langName = language === 'en' ? 'English' : 
                                language === 'fr' ? 'French' : 
                                language === 'de' ? 'German' : 'that language';
                                
                addBotMessage(`Looking for books in ${langName} to help with language learning...`);
                
                const response = await fetch(`${GUTENDEX_API}search?q=language:${language}`);
                const data = await response.json();
                
                if (data.books && data.books.length > 0) {
                    addBotMessage(`I found some great books in ${langName} that can help with your language learning. Would you like me to recommend some at your level?`);
                } else {
                    addBotMessage(`I couldn't find any ${langName} books at the moment. Try a different language or check back later.`);
                }
            } catch (error) {
                console.error('Error fetching books:', error);
                addBotMessage("Sorry, I had trouble finding language learning materials. Please try again later.");
            }
        }
        
        // Fetch recommended books
        async function fetchRecommendedBooks() {
            try {
                const response = await fetch(`${GUTENDEX_API}recommendations`);
                const data = await response.json();
                const books = data.books || [];
                
                const chatMessages = document.querySelector('.chat-messages');
                addBotMessage("I've found some books you might enjoy based on your reading history and preferences.");
            } catch (error) {
                console.error('Error fetching recommendations:', error);
                addBotMessage("I couldn't retrieve personalized recommendations right now. Please try again later.");
            }
        }

        // Fetch books for genres and top books
        async function fetchGenreBooks() {
            const booksContainer = document.getElementById('booksContainer');
            const topBooks = document.getElementById('topBooks');
            
            try {
                const response = await fetch(`${GUTENDEX_API}recommendations`);
                const data = await response.json();
                const books = data.books || [];

                // Clear loading indicator
                booksContainer.innerHTML = '';
                
                // Create genre cards (use the first 6 books as genre examples)
                const genres = [
                    { name: "Fiction", img: "https://via.placeholder.com/120x120?text=Fiction" },
                    { name: "Science Fiction", img: "https://via.placeholder.com/120x120?text=Sci-Fi" },
                    { name: "Mystery", img: "https://via.placeholder.com/120x120?text=Mystery" },
                    { name: "Romance", img: "https://via.placeholder.com/120x120?text=Romance" },
                    { name: "History", img: "https://via.placeholder.com/120x120?text=History" },
                    { name: "Philosophy", img: "https://via.placeholder.com/120x120?text=Philosophy" }
                ];
                
                // Use book covers if available, otherwise use placeholders
                books.slice(0, 6).forEach((book, index) => {
                    const coverUrl = book.cover || genres[index].img;
                    
                    const genreCard = document.createElement('div');
                    genreCard.className = 'genre-card';
                    genreCard.innerHTML = `
                        <img src="${coverUrl}" alt="${genres[index].name}" onerror="this.src='${genres[index].img}'">
                    `;
                    
                    genreCard.addEventListener('click', () => {
                        fetchBooksByCategory(genres[index].name.toLowerCase());
                    });
                    
                    booksContainer.appendChild(genreCard);
                });
                
                // Fill in missing genre cards if we don't have enough books
                if (books.length < 6) {
                    for (let i = books.length; i < 6; i++) {
                        const genreCard = document.createElement('div');
                        genreCard.className = 'genre-card';
                        genreCard.innerHTML = `
                            <img src="${genres[i].img}" alt="${genres[i].name}">
                        `;
                        
                        genreCard.addEventListener('click', () => {
                            fetchBooksByCategory(genres[i].name.toLowerCase());
                        });
                        
                        booksContainer.appendChild(genreCard);
                    }
                }
                
                // Update top books in the sidebar
                if (topBooks) {
                    topBooks.innerHTML = books.slice(0, 4).map(book => `
                        <div class="reader-card" onclick="navigateToBookDetails(${book.id})">
                            <span>${book.title.slice(0, 15)}${book.title.length > 15 ? '...' : ''}</span>
                            <span>${book.authors[0]?.split(',')[0] || 'Unknown'}</span>
                            <span>${book.download_count || 'N/A'}</span>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error fetching books:', error);
                booksContainer.innerHTML = '<p>Error loading books. Please try again later.</p>';
            }
        }

        // Load initial data when page loads
        document.addEventListener('DOMContentLoaded', fetchGenreBooks);
    </script>
</body>
</html>