<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-LibraryAI - Home</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="theme.css">
    <script src="side-bar.js" defer></script>
    <script src="common.js" defer></script>
    <script src="chat.js" defer></script>
    <script src="settings.js" defer></script>
    <style>
        /* Pagination Styles */
.pagination-container {
    display: flex;
    justify-content: center;
    margin: 30px 0;
}

.pagination {
    display: flex;
    gap: 10px;
    align-items: center;
    background-color: var(--secondary-bg);
    padding: 10px 20px;
    border-radius: 15px;
    transition: var(--theme-transition);
}

.page-btn {
    background-color: var(--tertiary-bg);
    color: var(--text-color);
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    cursor: pointer;
    transition: var(--theme-transition);
    min-width: 40px;
    text-align: center;
}

.page-btn:hover {
    background-color: var(--button-bg);
}

.page-btn.active {
    background-color: var(--highlight-color);
    font-weight: bold;
}

.page-btn:disabled {
    background-color: var(--bg-color);
    color: var(--secondary-text);
    cursor: not-allowed;
}

.ellipsis {
    color: var(--text-color);
    padding: 0 5px;
    transition: var(--theme-transition);
}

/* Book Card Styles */
.book-card {
    background-color: var(--secondary-bg);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    gap: 20px;
    transition: var(--theme-transition);
    border: 1px solid var(--border-color);
}

.book-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.book-image {
    width: 150px;
    height: 150px;
    border-radius: 10px;
    object-fit: cover;
}

.book-info {
    flex: 1;
    color: var(--text-color);
}

.book-info h2 {
    color: var(--text-color);
}

.book-info p {
    color: var(--secondary-text);
}

.progress-bar {
    width: 100%;
    height: 6px;
    background-color: var(--tertiary-bg);
    border-radius: 3px;
    margin: 10px 0;
    transition: var(--theme-transition);
}

.progress-fill {
    height: 100%;
    background-color: var(--highlight-color);
    border-radius: 3px;
    transition: var(--theme-transition);
}

.bookmark-btn {
    background: none;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    font-size: 20px;
    transition: var(--theme-transition);
}

.bookmark-btn:hover {
    transform: scale(1.2);
}

/* Right Sidebar */
.right-sidebar {
    width: 300px;
    background-color: var(--secondary-bg);
    padding: 20px;
    display: flex;
    flex-direction: column;
    position: relative;
    border-left: 1px solid var(--border-color);
    transition: width 0.3s ease, background-color 0.3s ease;
    gap: 10px;
}

.right-sidebar .collapse-btn {
    position: absolute;
    top: 20px;
    left: -15px;
    background-color: var(--tertiary-bg);
    border: none;
    color: var(--text-color);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    transition: var(--theme-transition);
}

.right-sidebar.collapsed {
    width: 70px;
}

.right-sidebar.collapsed .sidebar-content {
    display: none;
}

.sidebar-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow-y: auto;
    color: var(--text-color);
}

/* Back Button */
.back-btn {
    background-color: var(--tertiary-bg);
    color: var(--text-color);
    padding: 10px 20px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    margin-top: 20px;
    font-size: 14px;
    transition: var(--theme-transition);
}

.back-btn:hover {
    background-color: var(--button-bg);
}

.insights-btn {
    background-color: var(--highlight-color);
    color: white;
    padding: 10px 20px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    border: none;
    transition: var(--theme-transition);
}

.insights-btn:hover {
    background-color: #1557b0;
    transform: translateY(-2px);
}

/* Loading and Error States */
.loading, .error {
    padding: 20px;
    text-align: center;
    color: var(--secondary-text);
    background-color: var(--secondary-bg);
    border-radius: 10px;
    margin: 20px 0;
    transition: var(--theme-transition);
}

.error {
    border: 1px solid #ff4d4f;
    color: #ff4d4f;
}

/* Theme-specific adjustments */
body[data-theme="light"] .book-card {
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

body[data-theme="light"] .pagination {
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

body[data-theme="sepia"] .insights-btn {
    background-color: var(--highlight-color);
}

body[data-theme="sepia"] .insights-btn:hover {
    background-color: #865831;
}
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <img src="https://www.gutenberg.org/pics/pg-logo-002.png" alt="Logo">
            <span class="nav-text">E-LibraryAI</span>
        </div>
        <a href="home.html" class="nav-item">üè† <span class="nav-text">Home</span></a>
        <a href="search.html" class="nav-item">üîç <span class="nav-text">Search</span></a>
        <a href="recommendations.html" class="nav-item">üìö <span class="nav-text">Collections</span></a>
        
        <div style="margin-top: auto;">
            <a href="index.html" class="nav-item">üë§ <span class="nav-text">Profile</span></a>
            <a href="settings.html" class="nav-item">‚öôÔ∏è <span class="nav-text">Settings</span></a>
            <a href="login.html" class="nav-item">‚Ü™Ô∏è <span class="nav-text">Log Out</span></a>
        </div>
        <button class="collapse-btn">‚óÄ</button>
    </div>

    <div class="main-content" id="mainContent">
        <div class="header">
            <h1>Recommended Reads</h1>
            
            <button class="insights-btn" onclick="fetchInsights()">
                <span>üí°</span>
                Insights
            </button>
            <div class="header-icons">
                <span>üîî</span>
                <span>‚úâÔ∏è</span>
                <span>üí¨</span>
            </div>
        </div>
        
        <div id="booksList">
            <div class="loading">Loading recommended books...</div>
        </div>
        
        <div class="pagination-container">
            <div class="pagination" id="pagination">
                <button class="page-btn" id="prevBtn" disabled>‚Üê Previous</button>
                <div id="pageNumbers"></div>
                <button class="page-btn" id="nextBtn">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="chat-panel">
        <button class="collapse-btn">‚ñ∂</button>
        <div class="chat-content">
            <div class="chat-header">
                <h2>AI Book Assistant</h2>
                <span>‚ñº</span>
            </div>
            
            <div class="chat-messages">
                <!-- Chat messages will appear here -->
            </div>

            <div class="chat-input">
                <input type="text" placeholder="Ask about books...">
            </div>

            <div class="featured-books">
                <div onclick="fetchBooksByCategory('popular')">
                    <span>üìö Top Free eBooks</span>
                    <span>‚Üí</span>
                </div>
                <div onclick="fetchBooksByCategory('trending')">
                    <span>üåü Trending Now</span>
                    <span>‚Üí</span>
                </div>
                <div onclick="fetchBooksByCategory('classic')">
                    <span>üîñ Classic Literature</span>
                    <span>‚Üí</span>
                </div>
            </div>
        </div>
    </div>
       
    <script>
        const GUTENDEX_API = '/api/';
        let currentBooks = [];
        let currentPage = 1;
        const booksPerPage = 5; // Number of books to display per page
        
        // Fetch books based on parameters
        async function fetchBooks(params = '') {
            const booksContainer = document.getElementById('booksList');
            booksContainer.innerHTML = '<div class="loading">Loading books...</div>';

            try {
                const response = await fetch(`${GUTENDEX_API}recommendations${params}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                currentBooks = data.books || [];
                
                displayBooks(currentBooks, currentPage);
                renderPagination(currentBooks.length);
            } catch (error) {
                booksContainer.innerHTML = '<div class="error">Error loading books. Please try again.</div>';
                console.error('Error:', error);
            }
        }

        // Display books on the current page
        function displayBooks(books, page) {
            const booksContainer = document.getElementById('booksList');
            booksContainer.innerHTML = '';

            if (books.length === 0) {
                booksContainer.innerHTML = '<div class="loading">No books found. Try adjusting your preferences or check back later.</div>';
                return;
            }

            // Calculate start and end index for current page
            const startIndex = (page - 1) * booksPerPage;
            const endIndex = Math.min(startIndex + booksPerPage, books.length);

            // Get books for current page
            const booksToDisplay = books.slice(startIndex, endIndex);

            booksToDisplay.forEach(book => {
                const coverUrl = book.cover || 'https://via.placeholder.com/150/150';
                const progress = Math.floor(Math.random() * 100); // Simulated reading progress

                const bookCard = document.createElement('div');
                bookCard.className = 'book-card';
                bookCard.innerHTML = `
                    <img src="${coverUrl}" alt="${book.title}" class="book-image" onerror="this.src='https://via.placeholder.com/150/150'">
                    <div class="book-info">
                        <h2>${book.title}</h2>
                        <p>${book.authors.join(', ') || 'Unknown Author'}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <p>${progress}% complete</p>
                    </div>
                    <button class="bookmark-btn" onclick="toggleBookmark(this, event)">üîñ</button>
                `;

                bookCard.addEventListener('click', () => navigateToBookDetails(book.id));
                booksContainer.appendChild(bookCard);
            });
        }

        // Render pagination controls
        function renderPagination(totalBooks) {
            const totalPages = Math.ceil(totalBooks / booksPerPage);
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';

            // Show page numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    displayBooks(currentBooks, currentPage);
                    renderPagination(currentBooks.length);
                });
                pageNumbers.appendChild(pageBtn);
            }

            // Update previous/next buttons
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;

            // Add event listeners for prev/next buttons
            document.getElementById('prevBtn').onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayBooks(currentBooks, currentPage);
                    renderPagination(currentBooks.length);
                }
            };

            document.getElementById('nextBtn').onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayBooks(currentBooks, currentPage);
                    renderPagination(currentBooks.length);
                }
            };
        }

        // Toggle bookmark state
        function toggleBookmark(btn, event) {
            btn.textContent = btn.textContent === 'üîñ' ? 'üìë' : 'üîñ';
            event.stopPropagation(); // Prevent click from bubbling to card
            
            // Show confirmation in chat
            const bookTitle = btn.parentElement.querySelector('h2').textContent;
            const chatMessages = document.querySelector('.chat-messages');
            if (chatMessages) {
                const action = btn.textContent === 'üìë' ? 'bookmarked' : 'removed from bookmarks';
                addBotMessage(`"${bookTitle}" has been ${action}.`);
            }
        }

        // Navigate to book details page
        function navigateToBookDetails(bookId) {
            window.location.href = `book-details.html?id=${bookId}`;
        }

        // Fetch insights (show reading trends)
        function fetchInsights() {
            const chatMessages = document.querySelector('.chat-messages');
            if (chatMessages) {
                addBotMessage("üìä Based on your reading history, I've gathered some insights:");
                setTimeout(() => {
                    addBotMessage("You tend to read more fiction (65%) than non-fiction (35%). Your favorite genres are Science Fiction, Mystery, and Philosophy.");
                }, 500);
                setTimeout(() => {
                    addBotMessage("You read most often in the evenings between 8-10 PM, and you typically finish a book in about 12 days.");
                }, 1000);
                setTimeout(() => {
                    addBotMessage("Would you like me to suggest books based on your reading patterns?");
                }, 1500);
            }
        }

        // Fetch books by category
        function fetchBooksByCategory(category) {
            const chatMessages = document.querySelector('.chat-messages');
            if (chatMessages) {
                addBotMessage(`Looking for ${category} books for you...`);
            }
            
            // Add category to URL params
            fetchBooks(`?genre=${category}`);
        }

        // Initial load of books
        document.addEventListener('DOMContentLoaded', () => {
            fetchBooks(); // Load recommendations
            
            // Send welcome message in chat
            setTimeout(() => {
                const chatMessages = document.querySelector('.chat-messages');
                if (chatMessages && !chatMessages.querySelector('.message')) {
                    addBotMessage("Welcome to your personalized book recommendations! Here are some titles I think you'll enjoy based on your reading history and preferences.");
                }
            }, 500);
        });
    </script>
</body>
</html>